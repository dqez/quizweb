@model quizweb.ViewModels.UserEditViewModel
@{
    ViewData["Title"] = "Profile";
}
@* @model quizweb.Models.ApplicationUser *@
@* @{ *@
@*     ViewData["Title"] = "Profile"; *@
@* } *@
<div>
    <h1>Profile</h1>
    <div class="container">
        <div>
            <h2>@Model.Username</h2>
            <p><strong>Full Name:</strong> <span class="editable" data-field="FullName">@Model.Fullname</span></p>
            <p><strong>Email:</strong> <span class="editable" data-field="Email">@Model.Email</span></p>
            <p><strong>Birthday:</strong> <span class="editable" data-field="BirthDay">@Model.Birthday</span></p>
        </div>
    </div>
</div>

<style>
    .editable {
        cursor: pointer;
        padding: 4px 8px;
        border-bottom: 1px dashed #ccc;
        display: inline-block;
        min-width: 150px;
    }
    .editable:hover {
        background-color: #f0f0f0;
    }
    .editing-input {
        padding: 4px 8px;
        border: 2px solid #007bff;
        font-size: inherit;
        font-family: inherit;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const editables = document.querySelectorAll('.editable');
    
    editables.forEach(span => {
        span.addEventListener('click', function() {
            if (this.querySelector('input')) return; // Đang edit rồi thì thôi
            
            const fieldName = this.dataset.field;
            const currentValue = this.textContent;
            
            // Tạo input
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentValue;
            input.className = 'editing-input';
            
            // Xóa text, thêm input
            this.textContent = '';
            this.appendChild(input);
            input.focus();
            
            // Khi blur hoặc Enter → save
            const saveEdit = async () => {
                const newValue = input.value;
                
                if (newValue === currentValue) {
                    // Không thay đổi → restore
                    span.textContent = currentValue;
                    return;
                }
                
                try {
                    // Gọi AJAX
                    const response = await fetch('@Url.Action("UpdateField", "Profile")', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                        },
                        body: JSON.stringify({
                            fieldName: fieldName,
                            value: newValue
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        span.textContent = newValue;
                    } else {
                        alert('Error: ' + result.message);
                        span.textContent = currentValue;
                    }
                } catch (error) {
                    alert('Network error');
                    span.textContent = currentValue;
                }
            };
            
            input.addEventListener('blur', saveEdit);
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    this.blur();
                }
            });
        });
    });
});
</script>

@Html.AntiForgeryToken()